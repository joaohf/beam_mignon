<!doctype html><html lang=pt-br><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Gamepad | BEAM Mignon</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Criando um controle virtual"><meta name=generator content="Hugo 0.105.0-DEV"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Gamepad"><meta property="og:description" content="Criando um controle virtual"><meta property="og:type" content="article"><meta property="og:url" content="https://beam-mignon.netlify.app/posts/mignon-29/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-28T22:43:50+02:00"><meta property="article:modified_time" content="2022-10-15T18:02:15-03:00"><meta property="og:see_also" content="https://beam-mignon.netlify.app/posts/mignon-26/"><meta itemprop=name content="Gamepad"><meta itemprop=description content="Criando um controle virtual"><meta itemprop=datePublished content="2020-08-28T22:43:50+02:00"><meta itemprop=dateModified content="2022-10-15T18:02:15-03:00"><meta itemprop=wordCount content="2122"><meta itemprop=keywords content="code,driver,port,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gamepad"><meta name=twitter:description content="Criando um controle virtual"></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://beam-mignon.netlify.app/images/featured/29.jpg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">BEAM Mignon</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/contact/ title="Contato page">Contato</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Posts page">Posts</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/reference/ title="Referencias page">Referencias</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="Sobre page">Sobre</a></li></ul><div class=ananke-socials><a href=https://twitter.com/joaohf target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/joaohf/ target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jo%c3%a3o-henrique-freitas target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://beam-mignon.netlify.app/feed.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Gamepad</h1><h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">Criando um controle virtual</h2></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://beam-mignon.netlify.app/posts/mignon-29/&text=Gamepad" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://beam-mignon.netlify.app/posts/mignon-29/&title=Gamepad" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Gamepad</h1><time class="f6 mv4 dib tracked" datetime=2020-08-28T22:43:50+02:00>agosto 28, 2020</time>
<span class="f6 mv4 dib tracked">- 10 minutes read</span>
<span class="f6 mv4 dib tracked">- 2122 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Recentemente comprei uma
<a href=https://www.raspberrypi.org/products/raspberry-pi-4-model-b/>raspberry pi 4</a>
com o propósito de usar o projeto <a href=https://retropie.org.uk/>retropie</a> para
jogar video game do século passado. Depois que comprei, lembrei que precisava
também comprar controles (gamepads).</p><p>Pesquisando na documentação do retropie, verifiquei que existe opções de usar um
<code>virtual gamepad</code> e as duas soluções mais usadas são
<a href=https://retropie.org.uk/docs/Mobile-Gamepad/>Mobile-Gamepad</a> e
<a href=https://retropie.org.uk/docs/Virtual-Gamepad/>Virtual-Gamepad</a>.</p><p>Ambas as soluções funcionam do mesmo jeito sendo compostas por:</p><ul><li>frontend em javascript simulando um controle e enviando eventos dos botões e
direcionais para</li><li>backend nodejs usando <a href=https://socket.io/>socket.io</a> para receber os eventos
e escrever no dispositivo <em>/dev/uinput</em>.</li></ul><p><a href=https://www.kernel.org/doc/html/v4.12/input/uinput.html>uinput</a> é um módulo do
kernel linux no qual emula inputs de uma aplicação para serem entregues e
manipulados por outros processos em
<a class=glossary-tooltip href='/reference/glossary/?all=true#term-userland' target=_blank>userland<span class=tooltip-text>Qualquer aplicação ou código que execute fora do kernel do sistema operacional.</span></a> ou
<a class=glossary-tooltip href='/reference/glossary/?all=true#term-in-kernel' target=_blank>in-kernel<span class=tooltip-text>Espaço reservado para execução de códigos dentro do kernel do Sistema Operacional, device drivers e outros códigos privilegiados.</span>
</a>.</p><p>Bom, para resolver o meu problema dos controles, bastaria usar uma solução já
pronta. Mas resolvi reimplementar utilizando Elixir e o framework Phoenix. O
nome deste projeto é <a href=https://www.github.com/joaohf/epad>epad</a> e o objetivo é
criar um controle virtual onde posso usar um celular conectado via websocket e
enviando eventos a partir de uma aplicação web em javascript.</p><figure class="center bg-light-gray tc"><img class="center pt1" style=max-width:100%;width:auto;height:auto src=/posts/mignon-29/epad_client_hu6e98d6a2be5ec3ee6394f5cb1b063dd7_161778_500x400_fit_box_3.png width=500 height=250><figcaption><small><p>Interface web do controle virtual</p></small></figcaption></figure><p>Então, neste post vamos falar sobre:</p><ul><li>Elixir</li><li><a href=https://www.phoenixframework.org/>Phoenix Framework</a></li><li>Driver em Erlang</li><li>Release com
<a class=glossary-tooltip href='/reference/glossary/?all=true#term-crosscompile' target=_blank>cross compile<span class=tooltip-text>É uma técnica utilizada para compilar uma aplicação em uma determinada plataforma na qual não é, necessariamente, a mesma plataforma que irá executar a aplicação.</span></a></li></ul><h2 id=arquitetura>Arquitetura</h2><p><code>epad</code> é composto de três principais blocos:</p><ul><li>epad_web, abre e gerencia websockets entre o servidor e o cliente web</li><li>epad, faz a gestão entre usuários (players) e o driver que controla o device
uinput</li><li>driver, recebe eventos de um processo e escreve no respectivo descritor do
device uinput utilizando <a href=https://man7.org/linux/man-pages/man2/ioctl.2.html title=ioctl target=_blank>ioctl</a>
e <a href=https://man7.org/linux/man-pages/man2/write.2.html title=write target=_blank>write</a></li></ul><p>epad_web e epad foram escritos em Elixir. Já o driver (epad_driver) foi escrito
em C.</p><p>Erlang/OTP oferece alguns modos quando precisamos interfacear com APIs do
sistema operacional ou outras bibliotecas feitas em C/C++. Para este projeto
escolhi utilizar driver.</p><p>Outro ponto foi a escolha do Phoenix no qual possui uma gestão dos websockets e
com uma abstração na qual cada cliente tenha um processo representando um
usuário. Tudo passa a ser uma questão de envio e recebimento de mensagens.</p><p>A figura abaixo mostra os principais blocos da solução:</p><figure class="center bg-light-gray"><pre class=asciiart> +------+ +----+ +--------+ |epad
+----http----->+epad| |retropie| |client| +--+-+ +-----^--+ +------+ | | | | | |
| | +--v----------+--+ |uinput input| | | | Linux | +----------------+
</pre><figcaption><small><p class="tc bg-light-gray">Visão geral</p></small></figcaption></figure><p>Sobre a árvore de supervisão, para este projeto escolhi criar algo usando
<a href=https://hexdocs.pm/elixir/DynamicSupervisor.html title=DynamicSupervisor target=_blank>DynamicSupervisor</a>
pois, dependendo do jogo, podemos ter vários
players conectados.</p><figure class="center bg-light-gray tc"><img class="center pt1" style=max-width:100%;width:auto;height:auto src=/posts/mignon-29/epad_supervisor_hu5ad4521cbb32dbdb2dc71c814d2d7504_28214_500x400_fit_box_3.png width=360 height=356><figcaption><small><p>Árvore de supervisão</p></small></figcaption></figure><h2 id=detalhes-do-driver-epad>Detalhes do driver epad</h2><p>epad acompanha um driver Erlang implementado em C, responsável por receber um
evento, decodificar e chamar as funções nativas do Sistema Operacional para
interfacear com o Kernel Linux.</p><p>Sempre quando quisermos integrar códigos externos vamos precisar usar uma das
opções baixo:</p><ul><li>NIFs</li><li>Port Drivers</li><li>Ports</li><li>Erl Interface</li><li>C Nodes</li></ul><p>A melhor documentação para iniciar neste contexto é o manual
<a href=http://erlang.org/doc/tutorial/users_guide.html>Interoperability Tutorial User&rsquo;s Guide</a>.</p><p>Cada opção serve para determinado caso de uso. Para a aplicação epad, uma boa
opção é utilizar um <code>Port Driver</code>.</p><p>A implementação foi feita no arquivo:
<a href=https://github.com/joaohf/epad/blob/master/src/epad_driver.c>src/epad_driver.c</a>.</p><p>Os detalhes de como escrever drivers merecem um post separado. Neste post vou
apenas comentar os pontos principais.</p><div><aside class="callout black bg-light-green"><div class=type><svg class="large-icon"><use xlink:href="/dist/images/icons.svg#sprite-callout-opinion"/></svg></div><div class=content></div></aside></div><p>Todo driver começa com uma declaração das callbacks que serão implementadas bem
como as features que o driver vai suportar usando o tipo de dado
<a href=https://erlang.org/doc/man/driver_entry.html>ErlDrvEntry</a>:</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/src/epad_driver.c title="See https://github.com/joaohf/epad/blob/0.0.1/src/epad_driver.c source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/src/epad_driver.c<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#a6e22e>ErlDrvEntry</span> epad_driver_entry <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>	<span style=color:#f92672>.</span>driver_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;epad_driver&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	<span style=color:#f92672>.</span>extended_marker <span style=color:#f92672>=</span> <span style=color:#a6e22e>ERL_DRV_EXTENDED_MARKER</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#f92672>.</span>major_version   <span style=color:#f92672>=</span> <span style=color:#a6e22e>ERL_DRV_EXTENDED_MAJOR_VERSION</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	<span style=color:#f92672>.</span>minor_version   <span style=color:#f92672>=</span> <span style=color:#a6e22e>ERL_DRV_EXTENDED_MINOR_VERSION</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	<span style=color:#f92672>.</span>driver_flags    <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#f92672>.</span>start       <span style=color:#f92672>=</span> epad_drv_start,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	<span style=color:#f92672>.</span>stop        <span style=color:#f92672>=</span> epad_drv_stop,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#f92672>.</span>control     <span style=color:#f92672>=</span> epad_drv_control
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#a6e22e>DRIVER_INIT</span>(epad_driver) <span style=color:#f92672>/*</span> must match name <span style=color:#f92672>in</span> driver_entry <span style=color:#f92672>*/</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	return <span style=color:#f92672>&amp;</span>epad_driver_entry;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>}</span></span></code></pre></div></div><p><em>epad_driver</em> é um driver muito simples. Não vamos precisar implementar todas as
callbacks (veja aqui a lista completa
<a href=https://erlang.org/doc/man/driver_entry.html>driver_entry</a>) e a única callback
que vamos implementar é a
<a href=https://erlang.org/doc/man/driver_entry.html#control>.control</a>:</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/src/epad_driver.c title="See https://github.com/joaohf/epad/blob/0.0.1/src/epad_driver.c source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/src/epad_driver.c<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>static</span> ErlDrvSSizeT <span style=color:#a6e22e>epad_drv_control</span>(
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>	ErlDrvData data,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span> command,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>buf,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	ErlDrvSizeT buf_len,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	<span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>rbuf,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	ErlDrvSizeT rbuf_len)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#66d9ef>struct</span> epad_drv_state <span style=color:#f92672>*</span>state <span style=color:#f92672>=</span> (<span style=color:#66d9ef>struct</span> epad_drv_state <span style=color:#f92672>*</span>)data;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	<span style=color:#66d9ef>char</span> c[<span style=color:#ae81ff>32</span>];
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>short</span> type;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>short</span> code;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	<span style=color:#66d9ef>int</span> val;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	<span style=color:#66d9ef>switch</span> (command <span style=color:#f92672>&amp;</span> EPAD_CMD_MASK) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>	<span style=color:#66d9ef>case</span> EPAD_CMD_EVENT:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>		memcpy(<span style=color:#f92672>&amp;</span>c, buf, buf_len);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>		c[buf_len] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;\0&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>		<span style=color:#66d9ef>if</span> (sscanf(c, <span style=color:#e6db74>&#34;ev:%hi:%hi:%i&#34;</span>, <span style=color:#f92672>&amp;</span>type, <span style=color:#f92672>&amp;</span>code, <span style=color:#f92672>&amp;</span>val) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>			<span style=color:#66d9ef>goto</span> error_sscanf;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        <span style=color:#66d9ef>if</span> (emit(state<span style=color:#f92672>-&gt;</span>fd, type, code, val)) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>            driver_failure_posix(state<span style=color:#f92672>-&gt;</span>port, errno);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>			<span style=color:#66d9ef>goto</span> error_io;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>		<span style=color:#66d9ef>if</span> (emit(state<span style=color:#f92672>-&gt;</span>fd, EV_SYN, SYN_REPORT, <span style=color:#ae81ff>0</span>)) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>            driver_failure_posix(state<span style=color:#f92672>-&gt;</span>port, errno);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>			<span style=color:#66d9ef>goto</span> error_io;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>		}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>		<span style=color:#66d9ef>return</span> port_ctl_return_val(EPAD_RES_OK, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>*</span>rbuf);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>error_io:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    <span style=color:#66d9ef>return</span> port_ctl_return_val(EPAD_RES_IO_ERROR, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>*</span>rbuf);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>error_sscanf:
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    <span style=color:#66d9ef>return</span> port_ctl_return_val(EPAD_RES_ILLEGAL_ARG, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>*</span>rbuf);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>}</span></span></code></pre></div></div><p>O detalhe desta função está relacionado com o modo como os eventos são enviados
do ERTS para o driver pelo processo que faz a interface com o port driver:</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/lib/epad/devices/device.ex title="See https://github.com/joaohf/epad/blob/0.0.1/lib/epad/devices/device.ex source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/lib/epad/devices/device.ex<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>  <span style=color:#66d9ef>def</span> handle_cast({<span style=color:#e6db74>:event</span>, type_code_value}, <span style=color:#960050;background-color:#1e0010>%</span>__MODULE__{<span style=color:#e6db74>port</span>: port} <span style=color:#f92672>=</span> state) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#e6db74>:ok</span> <span style=color:#f92672>=</span> event_port_control(port, <span style=color:#a6e22e>@epad_cmd_event</span>, type_code_value)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    {<span style=color:#e6db74>:noreply</span>, state}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>  <span style=color:#66d9ef>end</span></span></span></code></pre></div></div><p>No código acima a função <code>event_port_control/3</code> vai chamar a função
<a href=https://erlang.org/doc/man/erlang.html#port_call-3 title=erlang:port_call/3 target=_blank>erlang:port_call/3</a>
na qual vai passar uma string contendo o
tipo do evento, código, e valor. Quando este valor for passado (sincronamente)
pela função erlang:port<em>call/3. Já a função epad_drv_control() vai receber a
string e parsear, obtendo os valores necessários para chamar o restante das
funções e finalmente comunicar com o device _uinput</em> aberto.</p><div><aside class="callout dark-gray bg-washed-green"><div class=type><svg class="large-icon"><use xlink:href="/dist/images/icons.svg#sprite-callout-tip"/></svg></div><div class=content>E pode ser utilizada quando precisamos passar algum tipo de flags de controle
nos quais caso haja falhas os erros devem ser tratados imediatamente.</div></aside></div><p>Um outro aspecto importante: reparem que a função <code>epad_drv_control()</code> recebe
<em>char *buf</em> e <em>ErlDrvSizeT buf_len</em>, no caso do epad_driver o valor vai ser uma
string em C. Mas podem haver casos em que seja necessário passar um
<a class=glossary-tooltip href='/reference/glossary/?all=true#term-erlang_term' target=_blank>Erlang term<span class=tooltip-text>Erlang term é uma unidade na qual expressa um valor em Erlang. Termos podem ser formados por tipos básicos ou complexos.</span>
</a>, aí vamos
precisar utilizar uma biblioteca chamada
<a href=https://erlang.org/doc/apps/erl_interface/ei_users_guide.html>Erlang_Interface</a>
para converter para estruturas em C e obter os valores corretos.</p><p>Enfim, falar de driver é sempre um assunto denso. Existem muitos exemplos de
como fazer e com suporte da documentação oficial fica menos complicado mas ainda
sim é necessário avaliar se não existe algum modo de implementar determinada
feature sem utilizar C/C++ fora do contexto do ERTS.</p><h2 id=phoenix-channels>Phoenix channels</h2><p><a href=https://hexdocs.pm/phoenix/channels.html>Phoenix Channels</a> implementa uma
abstração em cima de mensagens <a href=https://tools.ietf.org/html/rfc6455>websocket</a>
nas quais permitem extender o modelo de atores para interfaces e clientes. De
fato não é uma novidade pois o assunto já é antigo e bem estabelecido exemplos:</p><p>Vi a ideia pela primeira vez neste post:
<a href=http://armstrongonsoftware.blogspot.com/2009/12/comet-is-dead-long-live-websockets.html>Comet is dead long live websockets</a>
e depois projetos como <a href=http://nitrogenproject.com/>NitrogenProject</a>,
<a href=https://github.com/synrc/n2o>N2O</a> e
<a href=https://ninenines.eu/docs/en/cowboy/2.6/guide/ws_handlers/>Cowboy</a> começaram a
implementar APIs e infraestrutura necessária.</p><p>Mas com Elixir e Phoenix, ficou bem interessante pois o conceito e utilização
estão bem mais flexíveis e fáceis de usar.</p><p>Quando o channel é criado (ou seja, um usuário acessou a interface web) a
callback <code>join/3</code> é chamada para criar uma processo no qual representa uma
instância do driver epad.</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex title="See https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>  <span style=color:#66d9ef>def</span> join(<span style=color:#e6db74>&#34;epad:gamepad&#34;</span>, %{}, socket) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    device <span style=color:#f92672>=</span> <span style=color:#a6e22e>Epad</span><span style=color:#f92672>.</span>gamepad() <span style=color:#f92672>|&gt;</span> check_gamepad
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    {<span style=color:#e6db74>:ok</span>, assign(socket, <span style=color:#e6db74>:device</span>, device)}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>  <span style=color:#66d9ef>end</span></span></span></code></pre></div></div><p>Após a inicialização, o channel aguarda eventos vindos do cliente web, chamando
a callback <code>handle_in/3</code> para tratar os eventos:</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex title="See https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>  <span style=color:#66d9ef>def</span> handle_in(<span style=color:#e6db74>&#34;event&#34;</span>, %{<span style=color:#e6db74>&#34;code&#34;</span> <span style=color:#f92672>=&gt;</span> code, <span style=color:#e6db74>&#34;type&#34;</span> <span style=color:#f92672>=&gt;</span> type, <span style=color:#e6db74>&#34;value&#34;</span> <span style=color:#f92672>=&gt;</span> value}, socket) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#e6db74>:ok</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Device</span><span style=color:#f92672>.</span>send_event(socket<span style=color:#f92672>.</span>assigns[<span style=color:#e6db74>:device</span>], type, code, value)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    {<span style=color:#e6db74>:noreply</span>, socket}
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>  <span style=color:#66d9ef>end</span></span></span></code></pre></div></div><p>Repare que a função sempre recebe o estado do socket que está na variável
<code>socket</code>. Assim sabemos exatamente qual usuário estamos tratando.</p><p>Quando o usuário sair da interface web, a callback <code>terminate/2</code> é chamada para
finalizar o usuário criado:</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex title="See https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/lib/epad_web/channels/gamepad_channel.ex<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>  <span style=color:#66d9ef>def</span> terminate(_reason, socket) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#a6e22e>Player</span><span style=color:#f92672>.</span>stop(socket<span style=color:#f92672>.</span>assigns[<span style=color:#e6db74>:player</span>])
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>  <span style=color:#66d9ef>end</span></span></span></code></pre></div></div><h2 id=client-javascript-e-interface-web>Client javascript e interface web</h2><p>A parte web foi implementada em javascript. Claro que usei como base o projeto
<a href=https://www.github.com/sbidolach/mobile-gamepad title=sbidolach/mobile-gamepad target=_blank>sbidolach/mobile-gamepad</a>
e fiz algumas adaptações principalmente
removendo o suporte ao socket.io e usando phoenix channels.</p><p>Como não sou especialista em interfaces web, fiz o mínimo necessário para poder
apertar um botão e o evento ser enviado para o backend epad.</p><p>Seguem alguns detalhes interessantes.</p><p>Todos os artefatos web estão no diretório <em>assets</em>. Por padrão Phoenix Framework
cria uma estrutura de projeto baseada no <a href=https://webpack.js.org/>webpack</a>. Em
projetos puramente web, essa estrutura é bem conhecida e creio que facilita o
uso.</p><p>O arquivo package.json está preparado para importar duas dependências instaladas
pelo Phoenix:</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/assets/package.json title="See https://github.com/joaohf/epad/blob/0.0.1/assets/package.json source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/assets/package.json<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>  <span style=color:#e6db74>&#34;dependencies&#34;</span>: {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#e6db74>&#34;jquery&#34;</span>: <span style=color:#e6db74>&#34;^3.5.1&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#e6db74>&#34;nipplejs&#34;</span>: <span style=color:#e6db74>&#34;^0.8.5&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#e6db74>&#34;phoenix&#34;</span>: <span style=color:#e6db74>&#34;file:../deps/phoenix&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#e6db74>&#34;phoenix_html&#34;</span>: <span style=color:#e6db74>&#34;file:../deps/phoenix_html&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>  },</span></span></code></pre></div></div><p><a href=https://hexdocs.pm/phoenix/js/#phoenix>phoenix</a> é uma pequena biblioteca em
javascript no qual abstrai e exporta uma API para envio e recebimento de
mensagens websocket.</p><p>A implementação do cliente gamepad foi feita no arquivo
<a href=https://github.com/joaohf/epad/blob/master/assets/js/gamepad.js>assets/js/gamepad.js</a>
com ajuda da biblioteca <a href=https://jquery.com/>jquery</a> e também da biblioteca
<a href=https://www.github.com/yoannmoinet/nipplejs title=yoannmoinet/nipplejs target=_blank>yoannmoinet/nipplejs</a>
, responsável por criar os botões e joystick na
tela.</p><p>Basicamente quando o usuário aperta algum botão dois eventos são capturados:
<code>touchstart</code> e <code>touchend</code> sendo que para cada evento uma mensagem é enviada para
o backend com o código do evento:</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/assets/js/gamepad.js title="See https://github.com/joaohf/epad/blob/0.0.1/assets/js/gamepad.js source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/assets/js/gamepad.js<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>        <span style=color:#960050;background-color:#1e0010>$</span>(<span style=color:#e6db74>&#34;.btn&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>            <span style=color:#f92672>.</span>off(<span style=color:#e6db74>&#34;touchstart touchend&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>            <span style=color:#f92672>.</span>on(<span style=color:#e6db74>&#34;touchstart&#34;</span>, function(event) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>                channel<span style=color:#f92672>.</span>push(<span style=color:#e6db74>&#34;event&#34;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>                    <span style=color:#e6db74>type</span>: <span style=color:#ae81ff>0x01</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>                    <span style=color:#e6db74>code</span>: <span style=color:#960050;background-color:#1e0010>$</span>(this)<span style=color:#f92672>.</span>data(<span style=color:#e6db74>&#34;code&#34;</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>                    <span style=color:#e6db74>value</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>                });
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>                <span style=color:#960050;background-color:#1e0010>$</span>(this)<span style=color:#f92672>.</span>addClass(<span style=color:#e6db74>&#34;active&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>                hapticCallback();
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>            })
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>            <span style=color:#f92672>.</span>on(<span style=color:#e6db74>&#34;touchend&#34;</span>, function(event) {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>                channel<span style=color:#f92672>.</span>push(<span style=color:#e6db74>&#34;event&#34;</span>, {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>                    <span style=color:#e6db74>type</span>: <span style=color:#ae81ff>0x01</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>                    <span style=color:#e6db74>code</span>: <span style=color:#960050;background-color:#1e0010>$</span>(this)<span style=color:#f92672>.</span>data(<span style=color:#e6db74>&#34;code&#34;</span>),
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>                    <span style=color:#e6db74>value</span>: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>                });
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>                <span style=color:#960050;background-color:#1e0010>$</span>(this)<span style=color:#f92672>.</span>removeClass(<span style=color:#e6db74>&#34;active&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>            });</span></span></code></pre></div></div><p>Desta forma podemos criar qualquer tipo de botão, enviar os eventos e o backend
faz a conversão para o device uinput do Linux.</p><p>O resto da implementação são funções e tratamentos da interface web.</p><h2 id=release-e-instalação>Release e instalação</h2><h3 id=sobre-compilar-drivers-em-cc>Sobre compilar drivers em C/C++</h3><p>Já sabemos que a aplicação epad utiliza um driver Erlang para acessar o device
uinput. Drivers podem ser escritos em C ou C++ e geralmente precisam de um
arquivo <a href=https://github.com/joaohf/epad/blob/master/Makefile>Makefile</a> com as
regras de compilação, flags, includes e bibliotecas adicionais.</p><p>No caso do epad, o Makefile é simples, bastando criar uma
<a class=glossary-tooltip href='/reference/glossary/?all=true#term-shared_library' target=_blank>shared library<span class=tooltip-text>Bibliotecas compartilhadas são bibliotecas nas quais são carregadas pelos programas durante a inicialização ou ao longa da execução da aplicação principal.</span>
</a>. Mas
podem haver casos mais complicados e é por isso que usar a dependência
<a href=https://hex.pm/packages/elixir_make title="Package elixir_make" target=_blank>elixir_make</a>
faz sentido:</p><p>Includindo a dependência aqui:</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/mix.exs title="See https://github.com/joaohf/epad/blob/0.0.1/mix.exs source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/mix.exs<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>      {<span style=color:#e6db74>:elixir_make</span>, <span style=color:#e6db74>&#34;~&gt; 0.6&#34;</span>, <span style=color:#e6db74>runtime</span>: <span style=color:#66d9ef>false</span>}</span></span></code></pre></div></div><p>E chamando durante o comando de compilação (<code>mix compile</code>)</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/mix.exs title="See https://github.com/joaohf/epad/blob/0.0.1/mix.exs source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/mix.exs<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>      <span style=color:#e6db74>compilers</span>: [<span style=color:#e6db74>:elixir_make</span>, <span style=color:#e6db74>:phoenix</span>, <span style=color:#e6db74>:gettext</span>] <span style=color:#f92672>++</span> <span style=color:#a6e22e>Mix</span><span style=color:#f92672>.</span>compilers(),</span></span></code></pre></div></div><p>Então o <a href=https://github.com/joaohf/epad/blob/master/Makefile>Makefile</a>
customizado para as necessidades do epad vai ser chamado.</p><p>Lembrando que precisamos ter a opção de fazer cross compile pois vamos instalr o
epad em um hardware especifico. No Makefile, coloquei algumas redefinições para
obter o compilador usando variáveis do ambiente.</p><small>Arquivo Makefile
<a href=https://github.com/joaohf/epad/blob/0.0.1/Makefile title="See https://github.com/joaohf/epad/blob/0.0.1/Makefile source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/Makefile<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-make data-lang=make><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#960050;background-color:#1e0010>else</span> <span style=color:#960050;background-color:#1e0010>ifeq</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#66d9ef>$(</span>UNAME_SYS<span style=color:#66d9ef>)</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#960050;background-color:#1e0010>Linux)</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>	CC <span style=color:#f92672>?=</span> gcc
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>	CFLAGS ?<span style=color:#f92672>=</span> -O3 -std<span style=color:#f92672>=</span>c99 -finline-functions -Wall -Wmissing-prototypes
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>	CXXFLAGS ?<span style=color:#f92672>=</span> -O3 -finline-functions -Wall
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#960050;background-color:#1e0010>endif</span></span></span></code></pre></div></div><p>Usando esta técnica posso configurar qualquer
<a class=glossary-tooltip href='/reference/glossary/?all=true#term-toolchain' target=_blank>toolchain<span class=tooltip-text>É um conjunto de ferramentas organizadas nas quais são usadas para compilação ou execução de aplicações.</span></a> necessária.</p><div><aside class="callout mid-gray bg-light-gray"><div class=type><svg class="large-icon"><use xlink:href="/dist/images/icons.svg#sprite-callout-note"/></svg></div><div class=content><a href=https://www.github.com/abhiTronix/raspberry-pi-cross-compilers>abhiTronix/raspberry-pi-cross-compilers</a></div></aside></div><h3 id=geração-da-release>Geração da release</h3><p>O processo de geração da release é muito simples. Quando usamos Elixir, e a
partir da versão 1.9.x, a ferramenta mix já provê mecanismos para geração da
release. Bastando adicionar pequenas configurações. Exemplo;</p><small><a href=https://github.com/joaohf/epad/blob/0.0.1/mix.exs title="See https://github.com/joaohf/epad/blob/0.0.1/mix.exs source on GitHub" target=_blank>https://github.com/joaohf/epad/blob/0.0.1/mix.exs<i class=icon-github></i></a></small><div class=codewrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-elixir data-lang=elixir><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>        <span style=color:#e6db74>epad</span>: [
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>          <span style=color:#e6db74>applications</span>: [
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>            <span style=color:#e6db74>epad</span>: <span style=color:#e6db74>:permanent</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>          ],
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>          <span style=color:#e6db74>steps</span>: [
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>            <span style=color:#e6db74>:assemble</span>, <span style=color:#e6db74>:tar</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>          ],
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>          <span style=color:#e6db74>include_erts</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        ]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>      ],
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>      <span style=color:#e6db74>source_url</span>: <span style=color:#e6db74>&#34;https://github.com/joaohf/epad&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>      <span style=color:#e6db74>homepage_url</span>: <span style=color:#e6db74>&#34;https://github.com/joaohf/epad&#34;</span>,</span></span></code></pre></div></div><p>Preste atenção que não queremos incluir o ERTS na release gerada. Por dois
motivos:</p><ol><li>se incluirmos o ERTS, este provavelmente não vai executar em outra
arquitetura</li><li>iremos instalar um ERTS nativo no hardware alvo</li></ol><p>Enfim, o processo de geração de release foi documentado aqui
<a href=https://github.com/joaohf/epad#development>https://github.com/joaohf/epad#development</a></p><h3 id=erlang-no-hardware-alvo>Erlang no hardware alvo</h3><p>Estou usando uma raspberrypi4 com a distro retropie. A distro possui um
gerenciador de pacotes funcional no qual podemos instalar o compilador gcc,
baixar as fontes do Erlang/OTP e proceder com a instalação. Esse link descreve
todo o processo <a href=https://elinux.org/Erlang>https://elinux.org/Erlang</a>.</p><div><aside class="callout black bg-light-green"><div class=type><svg class="large-icon"><use xlink:href="/dist/images/icons.svg#sprite-callout-opinion"/></svg></div><div class=content><p>algum pacote já pronto. Mas pode não ser seguro ou a versão pode estar
desatualizada.</p><p>Enfim, para a minha finalidade funcionou. Mas não creio que seja a melhor opção.</p></div></aside></div><h2 id=verificando-o-funcionamento>Verificando o funcionamento</h2><p>Após instalar a aplicação epad e fazer as configurações documentadas aqui:
<a href=https://github.com/joaohf/epad#installing-and-configuring-epad-on-retropie>https://github.com/joaohf/epad#installing-and-configuring-epad-on-retropie</a>,
podemos instalar
<a href=https://github.com/joaohf/epad#debugging-uinput-events>algumas ferramentas</a> e
verificar se o Linux está recebendo os eventos quando pressionamos algum botão
no controle virtual:</p><ul><li>Usar o navegador do celular e acessar o endereço `http://IP:4000'</li><li>Acessar via ssh e listar os input devices, deve haver apenas um device:</li></ul><pre tabindex=0><code>sudo lsinput
</code></pre><ul><li>Executar a ferramenta input-events:</li></ul><pre tabindex=0><code>sudo input-events 0
</code></pre><ul><li>No celular, pressionando o botão &lsquo;A&rsquo; na interface web o evento vai ser
recebido pela ferramenta input-events</li></ul><p>Pronto está funcionando. O Linux recebeu o evento com sucesso.</p><h2 id=conclusão>Conclusão</h2><p>Bom, economizei algum dinheiro implementando o controle virtual. Agora só falta
chegar no final do <em>Super Mario</em> e salvar a princesa.</p><ul class=pa0><li class="list di"><a href=/tags/code/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">code</a></li><li class="list di"><a href=/tags/driver/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">driver</a></li><li class="list di"><a href=/tags/port/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">port</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">O que há neste posts</p><nav id=TableOfContents><ul><li><a href=#arquitetura>Arquitetura</a></li><li><a href=#detalhes-do-driver-epad>Detalhes do driver epad</a></li><li><a href=#phoenix-channels>Phoenix channels</a></li><li><a href=#client-javascript-e-interface-web>Client javascript e interface web</a></li><li><a href=#release-e-instalação>Release e instalação</a><ul><li><a href=#sobre-compilar-drivers-em-cc>Sobre compilar drivers em C/C++</a></li><li><a href=#geração-da-release>Geração da release</a></li><li><a href=#erlang-no-hardware-alvo>Erlang no hardware alvo</a></li></ul></li><li><a href=#verificando-o-funcionamento>Verificando o funcionamento</a></li><li><a href=#conclusão>Conclusão</a></li></ul></nav></div><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Relacionado</p><ul class="pa0 list"><li class=mb2><a href=/posts/mignon-26/>riemann echo</a></li><li class=mb2><a href=/posts/mignon-25/>eclero, coletando métricas</a></li><li class=mb2><a href=/posts/mignon-35/>Criando parser para arquivos texto</a></li><li class=mb2><a href=/posts/mignon-33/>Barramentos</a></li><li class=mb2><a href=/posts/mignon-32/>Simuladores em Erlang</a></li><li class=mb2><a href=/posts/mignon-31/>Aplicações distribuídas com OTP</a></li><li class=mb2><a href=/posts/mignon-24/>Brincando com Erlang nodes: cloonix</a></li><li class=mb2><a href=/posts/mignon-23/>Brincando com Erlang nodes: epmd</a></li><li class=mb2><a href=/posts/mignon-22/>Brincando com Erlang nodes: embedded</a></li><li class=mb2><a href=/posts/mignon-20/>Brincando com Erlang nodes: eclero</a></li><li class=mb2><a href=/posts/mignon-21/>Gerenciamento out-of-band: SSH</a></li><li class=mb2><a href=/posts/mignon-17/>Gerenciamento out-of-band: SQL</a></li><li class=mb2><a href=/posts/mignon-16/>meta-erlang com LTTng</a></li><li class=mb2><a href=/posts/mignon-15/>Ativando traces usando LTTng</a></li><li class=mb2><a href=/posts/mignon-12/>Trace instrumentando o código com dbg</a></li></ul></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://beam-mignon.netlify.app/>&copy; https://creativecommons.org/licenses/by/4.0/ 2023</a><div><div class=ananke-socials><a href=https://twitter.com/joaohf target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/joaohf/ target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jo%c3%a3o-henrique-freitas target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://beam-mignon.netlify.app/feed.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>