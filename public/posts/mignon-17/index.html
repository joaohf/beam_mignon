<!doctype html><html lang=pt-br><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Gerenciamento out-of-band: SQL | BEAM Mignon</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="A ideia deste post é abordar algumas maneiras de fazer um gerenciamento out-of-band de uma aplicação. E a inspiração veio desta discussão sqlapi: library to connect to your erlang server via SQL:
This library can help you to make an SQL server from your existing server.
For example you have a server and let it be ejabberd. You want to give a list of connected users. Of course you will start from making HTTP endpoint that will reply with JSON with list of users."><meta name=generator content="Hugo 0.105.0-DEV"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="Gerenciamento out-of-band: SQL"><meta property="og:description" content="A ideia deste post é abordar algumas maneiras de fazer um gerenciamento out-of-band de uma aplicação. E a inspiração veio desta discussão sqlapi: library to connect to your erlang server via SQL:
This library can help you to make an SQL server from your existing server.
For example you have a server and let it be ejabberd. You want to give a list of connected users. Of course you will start from making HTTP endpoint that will reply with JSON with list of users."><meta property="og:type" content="article"><meta property="og:url" content="https://beam-mignon.netlify.app/posts/mignon-17/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-14T22:43:50+02:00"><meta property="article:modified_time" content="2022-10-15T18:02:15-03:00"><meta property="og:see_also" content="https://beam-mignon.netlify.app/posts/mignon-21/"><meta itemprop=name content="Gerenciamento out-of-band: SQL"><meta itemprop=description content="A ideia deste post é abordar algumas maneiras de fazer um gerenciamento out-of-band de uma aplicação. E a inspiração veio desta discussão sqlapi: library to connect to your erlang server via SQL:
This library can help you to make an SQL server from your existing server.
For example you have a server and let it be ejabberd. You want to give a list of connected users. Of course you will start from making HTTP endpoint that will reply with JSON with list of users."><meta itemprop=datePublished content="2019-09-14T22:43:50+02:00"><meta itemprop=dateModified content="2022-10-15T18:02:15-03:00"><meta itemprop=wordCount content="899"><meta itemprop=keywords content="code,sql,elock,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Gerenciamento out-of-band: SQL"><meta name=twitter:description content="A ideia deste post é abordar algumas maneiras de fazer um gerenciamento out-of-band de uma aplicação. E a inspiração veio desta discussão sqlapi: library to connect to your erlang server via SQL:
This library can help you to make an SQL server from your existing server.
For example you have a server and let it be ejabberd. You want to give a list of connected users. Of course you will start from making HTTP endpoint that will reply with JSON with list of users."></head><body class="ma0 avenir bg-near-white"><header class="cover bg-top" style=background-image:url(https://beam-mignon.netlify.app/images/featured/20190823_131050-3-0.jpg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">BEAM Mignon</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/contact/ title="Contato page">Contato</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="Posts page">Posts</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/reference/ title="Referencias page">Referencias</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="Sobre page">Sobre</a></li></ul><div class=ananke-socials><a href=https://twitter.com/joaohf target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/joaohf/ target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jo%c3%a3o-henrique-freitas target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://beam-mignon.netlify.app/feed.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Gerenciamento out-of-band: SQL</h1></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"><a href="https://twitter.com/share?url=https://beam-mignon.netlify.app/posts/mignon-17/&text=Gerenciamento%20out-of-band:%20SQL" class="ananke-social-link twitter no-underline" aria-label="share on Twitter"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://beam-mignon.netlify.app/posts/mignon-17/&title=Gerenciamento%20out-of-band:%20SQL" class="ananke-social-link linkedin no-underline" aria-label="share on LinkedIn"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div><h1 class="f1 athelas mt3 mb1">Gerenciamento out-of-band: SQL</h1><time class="f6 mv4 dib tracked" datetime=2019-09-14T22:43:50+02:00>setembro 14, 2019</time>
<span class="f6 mv4 dib tracked">- 5 minutes read</span>
<span class="f6 mv4 dib tracked">- 899 words</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>A ideia deste post é abordar algumas maneiras de fazer um gerenciamento
out-of-band de uma aplicação. E a inspiração veio desta discussão
<a href=http://erlang.org/pipermail/erlang-questions/2018-March/095064.html>sqlapi: library to connect to your erlang server via SQL</a>:</p><blockquote><p>This library can help you to make an SQL server from your existing server.</p></blockquote><blockquote><p>For example you have a server and let it be ejabberd. You want to give a list
of connected users. Of course you will start from making HTTP endpoint that
will reply with JSON with list of users.</p></blockquote><blockquote><p>Then you will add some sort, filter, paging as query params and then will
write library that allows to make all this params and send them.</p></blockquote><blockquote><p>Another option is to put our sqlapi library, connect it to storage of
connected users and then connect to server as if it is a SQL server.</p></blockquote><p>Vou usar o termo <em>out-of-band</em> para explorar a ideia. Entretanto este termo vai
ser utilizado de forma incorreta aqui. A intenção é mostrar que podemos
gerenciar uma aplicação usando diferentes protocolos nos quais oferecem mais
flexibilidade.</p><p>A definição correta é esta
<a href=https://en.wikipedia.org/wiki/Out-of-band_management>out-of-band management</a>.</p><h2 id=caso-de-uso>Caso de uso</h2><p>Imagine que temos uma aplicação na qual controla uma fechadura virtual. Onde o
usuário necessita entrar com um código para acessar algum recurso, uma sala
física por exemplo.</p><p>Precisamos de um jeito onde o administrador desta fechadura virtual possa fazer
alguns ajustes:</p><ul><li>trocar o código de acesso</li><li>aumentar ou diminuir o timeout quando o usuário erra o código</li><li>colocar e remover o estado de operação da fechadura: &rsquo;em manutenção&rsquo; e
&lsquo;funcionando&rsquo;</li></ul><p>Também o administrador precisa obter as estatísticas de utilização:</p><ul><li>quantidade de códigos corretamente inseridos</li><li>quantidade de códigos errados</li><li>timeout configurado</li></ul><p>Quais são as opções que podemos implementar em uma aplicação em Erlang/Elixir ?
Levando em consideração:</p><ul><li>padronização</li><li>tempo de desenvolvimento para uma nova funcionalidade</li><li>possibilidade de integração com tecnologias já existente</li></ul><h2 id=fechadura-virtual>Fechadura virtual</h2><p>Neste post não estamos interessados na fechadura virtual mas sim nas interfaces
de gerenciamento. Então vamos usar um exemplo de uma fechadura virtual
utilizando
<a href=http://erlang.org/doc/design_principles/statem.html#example>gen_statem</a>.</p><p>A estrutura do nosso exemplo vai ser uma aplicação Erlang/OTP contendo os
seguintes módulos:</p><ul><li>elock_app: definição da aplicação</li><li>elock_sup: supervisor</li><li>elock_statem: gen_statem da fechadura virtual</li><li>elock_oob_sup: supervisor das interfaces OOB (out-of-band)</li><li>elock_sqlapi: implementação das callbacks necessárias para a sqlapi funcionar</li></ul><p>Disponibilizei o código que iremos trabalhar aqui:
<a href=https://github.com/joaohf/elock>elock</a>. E ao longo dos posts futuros vou
melhorando e incrementando com novas funcionalidades.</p><h2 id=sql-server>SQL server</h2><p>A ideia é embutir uma API SQL e imitar um servidor SQL, dentro da aplicação.
Isso pode ser feito a partir de uma conexão TCP na qual escuta conexões em
determinada porta, usando algum protocolo no qual implemente um servidor SQL. A
linguagem SQL é padronizada mas o protocolo usado pelos serviços não (exemplo:
Postgresql e Mysql), mas documentados:</p><ul><li><a href=https://dev.mysql.com/doc/dev/mysql-server/8.0.11/page_protocol_basics.html>https://dev.mysql.com/doc/dev/mysql-server/8.0.11/page_protocol_basics.html</a></li><li><a href=https://www.postgresql.org/docs/11/protocol.html>https://www.postgresql.org/docs/11/protocol.html</a></li></ul><p>Podemos usar algumas bibliotecas para implementar esta idéia:</p><ul><li><a href=https://github.com/flussonic/sqlapi>sqlapi</a></li><li><a href=https://github.com/K2InformaticsGmbH/sqlparse>sqlparse</a></li></ul><p>Aqui vamos utilizar a biblioteca sqlapi. Entretanto não vamos utilizar a versão
original em <a href=https://github.com/flussonic/sqlapi>flussonic/sqlapi</a> mas o meu
fork em <a href=https://github.com/joaohf/sqlapi>joaohf/sqlapi</a> com algumas melhorias
organizacionais mas mantendo a funcionalidade original.</p><p>Baseado nos nossos requisitos, vamos implementar as seguintes tabelas, colunas e
acessos:</p><ul><li>statistics:<ul><li>colunas: nok_code, ok_code</li><li>tipo de acesso: read</li></ul></li><li>timeout:<ul><li>colunas: timeout</li><li>tipo de acesso: read, update</li></ul></li><li>access_code:<ul><li>colunas: code</li><li>tipo de acesso: read, update</li></ul></li><li>service:<ul><li>colunas: state</li><li>tipo de acesso: read</li></ul></li></ul><p>Para acessar a nossa API SQL, vamos utilizar um cliente mysql conectando na
porta do serviço SQL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> mysql -h 127.0.0.1 -P <span style=color:#ae81ff>4406</span> -u elock -ppass elock</span></span></code></pre></div><p>Lembrando que a aplicação <em>elock</em> não possui nenhum banco de dados.</p><p>Então, vamos poder executar consultas SQL, como se fosse uma base de dados.
Exemplos:</p><ul><li><p>Obtendo as estatísticas acesso:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span> <span style=color:#66d9ef>SELECT</span> ok_code <span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>statistics</span>; </span></span></code></pre></div>Resultado:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> +---------+
</span></span><span style=display:flex><span>  | ok_code | +---------+ | <span style=color:#ae81ff>2</span> | +---------+ <span style=color:#ae81ff>1</span> row in set <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  </span></span></code></pre></div></p></li><li><p>Verificando o estado do serviço:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span> <span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> service;
</span></span><span style=display:flex><span>  </span></span></code></pre></div>Resultado:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> +-----------+ | state |
</span></span><span style=display:flex><span>  +-----------+ | inservice | +-----------+ <span style=color:#ae81ff>1</span> row in set <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  </span></span></code></pre></div></p></li><li><p>Atualizando o tempo para a fechadura fechar:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span> <span style=color:#66d9ef>UPDATE</span>
</span></span><span style=display:flex><span>  timeout <span style=color:#66d9ef>SET</span> timeout <span style=color:#f92672>=</span> <span style=color:#ae81ff>45000</span>; </span></span></code></pre></div>Resultado:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> Query OK, <span style=color:#ae81ff>1</span> row affected <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span> </span></span></code></pre></div></p></li><li><p>Verificando o novo timeout configurado:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span> <span style=color:#66d9ef>SELECT</span> <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span>
</span></span><span style=display:flex><span>  timeout; </span></span></code></pre></div>Resultado:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> +---------+ |
</span></span><span style=display:flex><span>  timeout | +---------+ | <span style=color:#ae81ff>45000</span> | +---------+ <span style=color:#ae81ff>1</span> row in set <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  </span></span></code></pre></div></p></li></ul><p>Também vamos implementar alguns comandos SQL nos quais são atalhos para as
consultas ou determinada ação que seja necessário exportar:</p><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span> <span style=color:#66d9ef>SELECT</span> reset_code(); </span></span></code></pre></div>Resultado:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> Query OK, <span style=color:#ae81ff>1</span> row affected <span style=color:#f92672>(</span>0.00 sec<span style=color:#f92672>)</span> </span></span></code></pre></div></p><p>A implementação é bastante simples:</p><ol><li>No arquivo
<a href=https://github.com/joaohf/elock/blob/mignon-17/src/elock_sqlapi.erl>elock_sqlapi.erl</a>
implementamos todas as callback do behaviour
<a href=https://github.com/joaohf/sqlapi/src/sqlapi.erl>sqlapi.erl</a> necessárias</li><li>Quando a aplicação recebe alguma query, a biblioteca sqlapi faz o parser e
chama alguma função do módulo elock_sqlapi para fazer o tratamento.</li><li>Em seguida a máquina de estado
<a href=https://github.com/joaohf/elock/blob/mignon-17/src/elock_statem.erl>elock_statem.erl</a>
é chamada para retornar ou configurar os valores da query</li><li>O último passo é retornar as respostas para a sqlapi no qual vai fazer todo o
tratamento da resposta.</li></ol><p>Desenvolvendo mais esta ideia, podemos conectar algum framework para ORM e
rapidamente ter uma interface web na qual utilize as tabelas acima citadas.</p><p>Para alguns DevOps, o uso de consultas SQL pode ser mais familiar e fácil acesso
do que outras soluções.</p><h2 id=conclusão>Conclusão</h2><p>Neste post vimos que existe outras formas de disponibilizar um acesso para as
APIs de operação e manutenção da aplicação. Talvez a solução mais comum hoje em
dia seja expor uma API utilizando HTTP e JSON.</p><p>Entretanto a abordagem deste post é para o leitor refletir que existe outras
formas de criar um acesso para manutenção. E dependendo das condições do projeto
podem ser bastante utilizadas.</p><ul class=pa0><li class="list di"><a href=/tags/code/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">code</a></li><li class="list di"><a href=/tags/sql/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">sql</a></li><li class="list di"><a href=/tags/elock/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">elock</a></li></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">O que há neste posts</p><nav id=TableOfContents><ul><li><a href=#caso-de-uso>Caso de uso</a></li><li><a href=#fechadura-virtual>Fechadura virtual</a></li><li><a href=#sql-server>SQL server</a></li><li><a href=#conclusão>Conclusão</a></li></ul></nav></div><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Relacionado</p><ul class="pa0 list"><li class=mb2><a href=/posts/mignon-21/>Gerenciamento out-of-band: SSH</a></li><li class=mb2><a href=/posts/mignon-24/>Brincando com Erlang nodes: cloonix</a></li><li class=mb2><a href=/posts/mignon-23/>Brincando com Erlang nodes: epmd</a></li><li class=mb2><a href=/posts/mignon-22/>Brincando com Erlang nodes: embedded</a></li><li class=mb2><a href=/posts/mignon-20/>Brincando com Erlang nodes: eclero</a></li><li class=mb2><a href=/posts/mignon-16/>meta-erlang com LTTng</a></li><li class=mb2><a href=/posts/mignon-15/>Ativando traces usando LTTng</a></li><li class=mb2><a href=/posts/mignon-12/>Trace instrumentando o código com dbg</a></li><li class=mb2><a href=/posts/mignon-35/>Criando parser para arquivos texto</a></li><li class=mb2><a href=/posts/mignon-33/>Barramentos</a></li><li class=mb2><a href=/posts/mignon-32/>Simuladores em Erlang</a></li><li class=mb2><a href=/posts/mignon-31/>Aplicações distribuídas com OTP</a></li><li class=mb2><a href=/posts/mignon-29/>Gamepad</a></li><li class=mb2><a href=/posts/mignon-26/>riemann echo</a></li><li class=mb2><a href=/posts/mignon-25/>eclero, coletando métricas</a></li></ul></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://beam-mignon.netlify.app/>&copy; https://creativecommons.org/licenses/by/4.0/ 2023</a><div><div class=ananke-socials><a href=https://twitter.com/joaohf target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://github.com/joaohf/ target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://www.linkedin.com/in/jo%c3%a3o-henrique-freitas target=_blank class="linkedin ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a><a href=https://beam-mignon.netlify.app/feed.xml target=_blank class="rss ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="RSS link" rel=noopener aria-label="follow on RSS——Opens in a new window"><span class=icon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path id="scale" d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>